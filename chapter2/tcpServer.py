#!/bin/python
import socket
import threading

def handle_client(client):
    req=client.recv(4096)
    print(f"received {req}")
    client.send("ACK!".encode())
    client.close()

if __name__ == '__main__':
    server=socket.socket(socket.AF_INET,socket.SOCK_STREAM) # creates a TCP Socket
    ip='127.0.0.1'
    port=2789
    server.bind((ip,port)) # bind the IP to a specific port
    server.listen(5) # makes the socket to listen for a connection
    print(f"***Listening {ip} on port {port}***")
    while True: # so that the server keeps listening in a loop
        client,addr=server.accept() # keeps waiting for the client to connect and as soon as client connects it returns clientsocket and addr
        print(f"***Accepted connection from {addr[0]} on port {addr[1]}**") # addr contains clients IP address and port
        mythread=threading.Thread(target=handle_client,args=(client,)) # thread has been used to handle the client so that our main thread will keep on listening for more incoming connections
        mythread.start()
